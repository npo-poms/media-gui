<div class="result-wrapper">

  <div class="search-result-count" ng-class="{ 'waiting' : searching }">
    <span class="count">{{ resultCount }}</span> resultaten gevonden
  </div>

  <div class="search-summary" ng-switch="!searchResultController.isFavorite() || searchResultController.modifiedFavorite()">
    Gezocht naar: {{ query.summary }}

    <span title="Zoekopdracht opslaan als favoriet" ng-switch-when="true" class="query-favorite animate-fade" ng-click="searchResultController.addFavorite()"> {{searchResultController.isFavorite() ? 'bewaar' : 'maak'}} favoriet </span>
    <span title="Zoekopdracht opslaan als favoriet" ng-switch-default class="query-favorite animate-fade" ng-click="searchResultController.removeFavorite()"> verwijder favoriet </span>
    <span ng-if="mayDownload" class="csvdownload">
      <a  ng-if="!downloading && ! csvUrl" ng-click="searchResultController.download($event)">
        CSV
      </a>
      <a ng-if="csvUrl" href="{{csvUrl}}" class="downloaded" target="_blank">download CSV</a>
      <span ng-if="downloading" class="downloading">CSV wordt gemaakt</span>
    </span>
  </div>

</div>

<poms-pager ng-show="searchResults.total > searchResults.max" class="pager" searchresults="searchResults"
            onsearch="searchResultController.submit(offset)"></poms-pager>

<div class="table-wrapper" ng-class="{ 'updating' : searching }">
  <div class="default-sort btn-text-icon-uploads btn-text-icon animate-fade" ng-if="sort != 'relevance'">
    <span ng-click="searchResultController.defaultSort();"> Sorteer op relevantie</span>

  </div>
  <table ng-show="hasResults" class="search-results-list poms-table" ng-class="{ 'updating' : searching }" >
    <thead>

    <tr class="poms-table-head-row">
      <th class="poms-table-header column-checkbox" ></th>
      <th class="poms-table-header " ng-class="{'sortable' : column.sortable, 'ordered': sort == column.id, 'column-{{::column.id}}': true }"
          ng-repeat="column in selectedColumns" ng-click="searchResultController.toggleSort(column)">
                <span class="{{order}} column-header" title="{{column.value}}">
                    {{ column.tableValue || (column.tableValue == '' ? '' : column.value) }}
                </span>
      </th>
      <th class="poms-table-header column-tools" ng-show="!search.parentMid">
        <poms-search-columns></poms-search-columns>
      </th>
    </tr>
    </thead>

    <tbody>
    <tr data-id="{{ item.mid }}" ng-repeat="item in searchResults.items"
        class="poms-table-row search-result-row"
        ng-class="{ selected: item.selected, disabled : !searchResultController.mayWrite(item),  'deleted-row': item.workflow.id == ('FOR_DELETION' || 'DELETED') }"
        ng-dblclick="searchResultController.selectResult(item)">

      <td  class="checkbox-cell column-checkbox" ng-click="searchResultController.toggleSelect( item )">
        <input type="checkbox" ng-checked="item.selected" class="search-result-checkbox" >
      </td>

      <td ng-repeat="column in selectedColumns " ng-switch on="column.id" class="column-{{column.id}}">
        <span ng-switch-when="workflow">
          <poms-workflow mid="::item.mid" workflow="item.workflow" on-deleted="searchResultController.onDeleteResult()"></poms-workflow>
        </span>

        <span ng-switch-when="preview">
          <a class="preview-image" title='bekijk de volledige afbeelding' href="{{::item.image | mediaFullImage }}" target="blank" ng-if="::item.image" style="background-image: url('{{::item.image | mediaGridImage }}')">
          </a>
        </span>

        <span ng-switch-when="locations">
          <span class='location-count' ng-if="item.locations.length > 0 " ng-attr-title="{{membersController.locationTypes(member.locations).join(',')}}">
            {{::item.numberOfLocations}} (<span ng-repeat="locationType in ::searchResultController.locationTypes(item.locations)">{{locationType}}{{$last ? '' : ', '}}</span>)
          </span>
        </span>

        <span ng-switch-when="sortDate">
          <span title="{{::$parent.item | searchColumnFilter:column.id }}"> {{::$parent.item | searchColumnFilter:column.id }}
            <span ng-if="::$parent.item.sortDateScheduleEvent">({{::$parent.item.sortDateScheduleEvent.channel.id}})</span>
          </span>
        </span>

        <span ng-switch-when="firstScheduleEvent">
          <span ng-if="::$parent.item.firstScheduleEvent" title=" {{::$parent.item.firstScheduleEvent.start| searchColumnFilter:column.id }}">
            {{::$parent.item.firstScheduleEvent.start | searchColumnFilter:column.id}} ({{::$parent.item.firstScheduleEvent.channel.id}})
          </span>
        </span>
        <span ng-switch-when="lastScheduleEvent">
          <span ng-if="::$parent.item.lastScheduleEvent" title="{{::$parent.item.lastScheduleEvent.start | searchColumnFilter:column.id }}">
            {{::$parent.item.lastScheduleEvent.start | searchColumnFilter:column.id}} ({{::$parent.item.lastScheduleEvent.channel.id}})
          </span>
        </span>
        <span ng-switch-when="streamingPlatformStatus" ng-title="{{::$parent.item.streamingPlatformStatus.displayName | searchColumnFilter:column.id }}">
            {{::$parent.item.streamingPlatformStatus.displayName}}
        </span>
        <span ng-switch-when="mid">
          <poms-clipboard field="item.mid"></poms-clipboard>
        </span>

        <span ng-switch-default>
          <span title="{{::$parent.item | searchColumnFilter:column.id }}"> {{::$parent.item | searchColumnFilter:column.id }}</span>
        </span>
      </td>

      <td class="column-tools" ng-show="!search.parentMid">
        <div class="tools">
                    <span class=" poms-icon icon-preview"
                          ng-click="searchResultController.previewResult( $index )"
                          title="preview"></span>

          <a class="poms-icon icon-edit"
             ng-click="searchResultController.editResult(item)"
             title="edit"></a>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<poms-pager ng-show="searchResults.total > searchResults.max" ng-show="hasResults" class="pager"
            searchresults="searchResults" onsearch="searchResultController.submit(offset)"></poms-pager>
