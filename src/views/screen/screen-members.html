<div id="{{section}}" class="media-data media-members media-section">

    <h1 class='media-section-title' ng-class="{'waiting': waiting}">
        {{header}} ({{members.length}})
        <poms-help field="{{helpField}}"></poms-help>
    </h1>

    <button class="btn-text-icon btn-text-icon-add" ng-if="screenMemberController.mayWrite" ng-click="screenMemberController.addMember()">
        Onderdeel toevoegen
    </button>

    <table class="poms-table" ng-if="members.length > 0" ng-class="{'updating': waiting}">

        <thead>
        <tr class="poms-table-head-row">
            <th class="poms-table-header column-sort" ng-if="screenMemberController.mayWrite && members.length > 1 "></th>
            <th title="column.value" class="poms-table-header column-{{::column.id}}" ng-repeat="column in selectedColumns">
                {{ column.tableValue || (column.tableValue == '' ? '' : column.value) }}
            </th>

            <th class="poms-table-header column-tools">
                <screen-member-columns namespace="type"></screen-member-columns>
            </th>
        </tr>
        </thead>

        <tbody ui-sortable="sortableOptions" ng-model="members">
        <tr class="poms-table-row" ng-repeat="member in members  | limitTo: displayQuantity"
            ng-class="{ 'editing': rowform.$visible, 'may-write': screenMemberController.mayWrite, 'deleted-row': member.workflow.id == ('FOR_DELETION' || 'DELETED') }"
            ng-dblclick="screenMemberController.openInEditor( $event, member.mid, rowform )"
            >

            <td class="column-sort" ng-if="::screenMemberController.mayWrite && members.length > 1">
                <span class="sort-handle"></span>
            </td>

            <td class="column-{{::column.id}}" ng-repeat="column in selectedColumns " ng-switch on="column.id">

                <span ng-switch-when="workflow">
                      <poms-workflow mid="::member.mid" workflow="member.workflow"></poms-workflow>
                </span>

                <span ng-switch-when="preview">
                    <div class="preview-image-container">
                        <a class="preview-image" title='bekijk de volledige afbeelding' href="{{::member.image | mediaFullImage }}" target="blank" ng-if="::member.image" style="background-image: url('{{member.image | mediaGridImage }}')">
                        </a>
                        <span class="preview-image" ng-if="!member.image"></span>
                    </div>
                </span>


                <span title="volgnummer" ng-switch-when="number" ng-click="screenMemberController.edit(rowform, $event)" >
                    <span editable-number="::member.number" e-name="number" e-form="rowform" >
                        {{::member.number}}
                    </span>
                </span>

                <span title="uitgelicht" ng-switch-when="highlighted" editable-checkbox="::member.highlighted" e-name="highlighted" e-form="rowform" >
                    <span class="highlighted" ng-class="{'selected' : member.highlighted}"></span>
                </span>

                <span ng-switch-when="locations">
                    <span class='location-count' ng-if="member.locations.length > 0 " ng-attr-title="{{screenMemberController.locationTypes(member.locations).join(',')}}" >
                        {{::member.locations.length}} (<span ng-repeat="locationType in ::screenMemberController.locationTypes(member.locations)">{{locationType}}{{$last ? '' : ', '}}</span>)
                    </span>
                </span>

                <span ng-switch-when="sortDate">
                    <span title="{{::member | searchColumnFilter:column.id }}"> {{::member | searchColumnFilter:column.id }}
                        <span ng-if="::member.sortDateScheduleEvent">({{::member.sortDateScheduleEvent.channel.id}})</span>
                    </span>
                </span>

                <span ng-switch-default>
                    <span title="{{::member | searchColumnFilter: column.id }}">{{::member | searchColumnFilter: column.id }}</span>
                </span>

            </td>

            <td class="column-tools" ng-show="screenMemberController.mayWrite">

                <form editable-form name="rowform" onbeforesave="screenMemberController.updateMember(member, $data)"
                      ng-show="rowform.$visible" class="form-buttons form-inline">
                    <button title='bewaar' type="submit" ng-disabled="rowform.$waiting" class="btn btn-primary">
                        bewaar
                    </button>
                    <button title='annuleer' type="button" ng-disabled="rowform.$waiting" ng-click="screenMemberController.cancel($index, rowform)"
                            class="btn btn-default">
                        annuleer
                    </button>
                </form>

                <div class="tools" ng-show="!rowform.$visible">
                    <button title='edit' class="poms-icon icon-edit" ng-click="screenMemberController.openInEditor( $event, member.mid, rowform )">bewerk</button>
                    <button title='verwijder' class="poms-icon icon-remove" poms-confirm="Onderdeel" poms-submit="screenMemberController.remove(member)">Onderdeel
                        verwijder
                    </button>
                </div>
            </td>
        </tr>

        </tbody>
    </table>

    <div class='show-all-rows' ng-if="displayQuantity < members.length" ng-click="screenMemberController.showAllMembers()">
        <a> Toon alle {{members.length}} {{::header | lowercase}} </a>
    </div>

</div>
